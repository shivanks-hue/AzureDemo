# Azure DevOps Pipeline for Java Maven Selenium Project

trigger:
  - main

pool:
  # vmImage: 'ubuntu-latest'
  Default

variables:
  MAVEN_OPTS: "-Xmx1024m"

steps:
# Step 1: Checkout code
- checkout: self

# Step 2: Setup JDK
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '21'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: PreInstalled

# Step 3: Cache Maven packages for faster builds
- task: Cache@2
  inputs:
    key: 'maven | "$(Agent.OS)" | **/pom.xml'
    path: ~/.m2/repository
    restoreKeys: |
      maven | "$(Agent.OS)"

# Step 4: Install Chrome for Selenium tests
- script: |
    sudo apt-get update
    sudo apt-get install -y wget unzip
    wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get install -f -y
  displayName: 'Install Google Chrome'

# Step 5: Build Maven project
- script: mvn clean compile
  displayName: 'Maven Clean & Compile'

# Step 6: Run Selenium tests (headless mode recommended)
- script: mvn test
  displayName: 'Run Selenium Tests'

# Step 7: Package project (optional)
- script: mvn package
  displayName: 'Maven Package'
